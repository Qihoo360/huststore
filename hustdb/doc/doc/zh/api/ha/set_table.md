## set_table ##

**接口:** `/set_table`

**方法:** `POST`

**参数:** 

**场景 1**  （获取 `id`）

无

**场景 2**  （利用已经获得的 `id` 设置负载均衡表）

*  **id** （必选）  `hustdb ha` 分配的合法id
*  **table** （必选）  新的负载均衡表，必须放在 `http body` 中

该接口用于在运行时动态设置负载均衡表。在 `hustdb` 集群增加或者减少机器的时候，可以利用此接口更新 `hustdb ha` 集群的负载均衡表。

说明： **此接口会导致 HA 重启，以便使得新的配置生效** 。基于这一点，该接口需要具备高安全性，因此 `hustdb ha` 会动态生成 id，并使用 `RSA` 进行加密，以此作为合法的身份认证标识。 

该接口的工作模式为：  
- `client` 向 `hustdb ha` 发送 `set_table` 命令（不带任何参数），获取由 `RSA` 加密后的 id  
- `client` 利用私钥解密得到明文 id  
- `client` 向 `hustdb ha` 发送 `set_table` 命令（以明文 id 作为参数，否则请求会被拒） 设置负载均衡表  
- `hustdb ha` 校验 id 以及负载均衡表内容的合法性，校验通过则返回 `200`，同时更新现有的负载均衡表，重启服务

**使用范例:**

请参考脚本 `hustdb/ha/nginx/test/set_table.py`

[上一级](../ha.md)

[回首页](../../index.md)